# OnlineTracker Docker Compose
# Server and agent deployment

services:
  # Main server instance
  onlinetracker-server:
    build: .
    container_name: onlinetracker-server
    environment:
      - MODE=server
      - WEB_PORT=8000
      - COMS_PORT=19443
    ports:
      - "8000:8000"      # Web UI
      - "19443:19443"    # Agent communication
    volumes:
      - onlinetracker-data:/data
    restart: unless-stopped

  # Test agent instance
  # To use: set shared secret and allowed UUIDs in Settings first
  onlinetracker-agent:
    build: .
    container_name: onlinetracker-agent
    environment:
      - MODE=agent
      - AGENT_NAME=TAB2
      - SERVER_HOST=onlinetracker-server
      - COMS_PORT=8000
      - SHARED_SECRET=test-secret-change-me
    volumes:
      - onlinetracker-agent-data:/data
    depends_on:
      - onlinetracker-server
    restart: unless-stopped

volumes:
  onlinetracker-data:
  onlinetracker-agent-data:
